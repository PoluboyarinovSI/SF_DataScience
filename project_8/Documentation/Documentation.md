# Рекомендательная система для интернет-магазина Retailrocket
Бизнес-задача: повышение прибыли от дополнительных продаж в интернет-магазине на 20 %.
Техническая задача: реализовать рекомендательную систему товаров для главной страницы сайта.
Техническая метрика: Precision@3.

# Описание исходных жанных

events — датасет с событиями. Колонки:

timestamp — время события
visitorid — идентификатор пользователя
event — тип события
itemid — идентификатор объекта
transactionid — идентификатор транзакции, если она проходила
category_tree — файл с деревом категорий (можно восстановить дерево).

category_id — идентификатор категорий
parent_id — идентификатор родительской категории
item_properties — файл с свойствами товаров.

timestamp — момент записи значения свойства
item_id — идентификатор объекта
property — свойство, кажется, они все, кроме категории, захешированы
value — значение свойства
    
# Описание трансформации исходного датасета, чтобы получить датасет для обучения

Для реализации рекомендательной системы была выбрана модель ALS-модель. 
Для обучения данной модели необходима подготовка разреженной матрицы. 
Предварительно необходимо создать столбец (целевой) со значниями: наличие транзакции = 1; отсутствие транзакции = 0.
Создание разреженной матрицы осуществляется при помощие метода csr_matrix из библиотеки scipy.
Разбиение датасета на тренировочную и валидационную выборки осуществляется отсечкой по дате: 2015-07-15.
После чего на тренировочном датасете обучается ALS-модель с оценкой метрики precision at 3 на валидационном датасете.

# Проведенные эксперименты: описание моделей, гиперпараметров, полученной целевой метрики

## Модель колоборативной фильтрации
Реализована модель коллоборативной фильтрации
Оценка результатов проведена на 50 случайных записях, значениие метрики Precision@3 составило 0.34.

## Модель LightFM
Эксперименты с гиперпараметрами LightFM: no_components=150, learning_rate=0.05, loss='logistic'.
Значение метрики Precision@3 составило 0.74

## XGBoost (задача классификации)
Полученные значения метрик:
precision_score =  0.0112
recall_score =  0.4584
f1_score =  0.0219
accuracy =  0.6613
      
## Модель ALS (факторизационные машины)
    Для реализации модели был введен новый фактор event_scores. Далее для эксперимента были закодированы столбцы идентификаторов, 
    чтобы можно было преобразовать их в разреженную матрицу для экономии места и чтобы наша модель была способна вычислять 
    все возможные взаимодействия в наборе данных. 
    Были сформированы функции для выдачи рекомендаций: recommend_item_to_user и similar_items_to_item.
    Значение  Precision at 3 составило 0.13
    
    
# Описание API

    Сервис работает через отправку GET запроса с параметром visitorid, равным visitorid пользотеля, которому нужно сделать рекоммендации. 
    Сервис доступен по адресу 0.0.0.0:8888
    Endpoint для снятия рекомендаций в формате JSON - 0.0.0.0:8888/recomm 
    Для получения рекомендаций необходимо сделать запрос с параметром visitorid, куда необходимо передать visitorid пользователя, 
    которому нужно предложить рекомендации.       
    Например: 0.0.0.0:8888 - текстовый вывод рекомендаций 0.0.0.0:8888/recomm/?visitorid=97154 - endpoint c JSON
    
# Описание команд для запуска сервиса 

Команда для создания контейнера:
    docker build -t recomender .
Команда для запуска контейнера:
    docker run -d -p 8888:8888 recomender recomender
Команда для просмотра результата:    
    http://0.0.0.0:8888/?visitorid=1
Команда для остановки сервиса:
    docker ps -a
    docker stop <docker_id>

# Описание структуры проекта

    Dockerfile - контейнер, устанавливающий необходимые библиотеки (flask, pandas, numpy) и запускающий веб-сервис с порта 8888;
    requirements.txt - список необходимых для запуска сервиса библиотек, используется при первом запуске контейнера;
    predictions.py - исполняемый файл сервиса, содержит рекомендательную модель;
    app.py - исполняемый файл сервиса, содержит маршрутизацию;
