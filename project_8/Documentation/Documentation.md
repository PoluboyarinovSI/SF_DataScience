# Рекомендательная система для интернет-магазина Retailrocket
- Бизнес-задача: повышение прибыли от дополнительных продаж в интернет-магазине на 20 %.
- Техническая задача: реализовать рекомендательную систему товаров для главной страницы сайта.
- Техническая метрика: Precision@3.


# Описание исходных жанных

events — датасет с событиями. Колонки:

timestamp — время события
visitorid — идентификатор пользователя
event — тип события
itemid — идентификатор объекта
transactionid — идентификатор транзакции, если она проходила


category_tree — файл с деревом категорий (можно восстановить дерево). Колонки:

category_id — идентификатор категорий
parent_id — идентификатор родительской категории


item_properties — файл с свойствами товаров. Колонки:

timestamp — момент записи значения свойства
item_id — идентификатор объекта
property — свойство, кажется, они все, кроме категории, захешированы
value — значение свойства
    
# Описание трансформации исходного датасета, чтобы получить датасет для обучения

Предварительно необходимо создать столбец (целевой) со значниями: наличие транзакции = 1; отсутствие транзакции = 0.
Создание разреженной матрицы осуществляется при помощие метода csr_matrix из библиотеки scipy.
Разбиение датасета на тренировочную и валидационную выборки осуществляется отсечкой по дате: 2015-07-15.
После чего на тренировочном датасете обучается модель с оценкой метрики precision at 3 на валидационном датасете.


# Проведенные эксперименты: описание моделей, гиперпараметров, полученной целевой метрики

## Модель колоборативной фильтрации
Реализована модель коллоборативной фильтрации
Оценка результатов проведена на 50 случайных записях, значениие метрики Precision@3 составило 0.34.

## Модель LightFM
Модель обучена в Google Colab в рамках отдельного ноутбука по ссылке: https://github.com/PoluboyarinovSI/SF_DataScience/blob/main/project_8/lfm_model.ipynb
Эксперименты с гиперпараметрами LightFM: no_components=150, learning_rate=0.05, loss='warp', random_state=42.
Значение метрики Precision@3 составило 0.17493

## Модель ALS
Реализована модельн факторизационных машин ALS.
Значение  Precision at 3 составило 0.00068885

## XGBoost (задача классификации)
Реализована модель XGBoost для задач классификации. Полученные значения метрик:
precision_score =  0.0112
recall_score =  0.4584
f1_score =  0.0219
accuracy =  0.6613


# Выбор итоговой модели для построения рекомендаций

Для реализации рекомендательной системы была в качестве итоговой была выбрана модель LightFM, обученная в рамках ноутбука на Google Colab:
https://github.com/PoluboyarinovSI/SF_DataScience/blob/main/project_8/lfm_model.ipynb

Сохраненная модель и сопутствующие файлы для реализации рекомендательной системы размещены на Google-диске:
https://drive.google.com/drive/folders/1ZQ1UlJwg-SSqRpZDoRqTE3__D-PN7evF?usp=sharing


# Описание реализованного API

- Реализованный API-сервис работает посредтсвом отправки GET-запроса. В качестве параметра GET-запроса необходимо указать идентификатор пользвателя.
- API-сервис доступен по адресу 0.0.0.0:5000
- В API-сервисе реализован ENDPoint для получения рекомендации в формате JSON. 
- ENDPoint доступен по адресу 0.0.0.0:5000/recomendations   
- Формат GET-запросов: 
- 0.0.0.0:5000/?visitorid=5
- 0.0.0.0:5000/recomendations/?visitorid=5
    

# Описание команд для запуска сервиса (из дирректории web)

- Создание docke-контейнера: docker build -t retail_recomender .
- Запуск docker-контейнера: docker run -d -p 5000:5000 retail_recomender retail_recomender
- Отображение результата результата формирования рекомендаций: http://0.0.0.0:5000/?visitorid=5
- Остановка docker-контейнера: docker ps -a / docker stop <docker_id>


# Описание структуры проекта (web)

- Dockerfile - контейнер, который устанавливает необходимые библиотеки и запускает веб-сервис
- requirements.txt - файл, содержащий список пакетов и библиотек, необходимых для работы API-сервиса
- app/server.py - исполняемый файл API-сервиса, который реализует маршрутизацию сервиса
- app/predictor.py - исполняемый файл API-сервиса, который реализует рекомендательную систему на основе сохраненной модели,
               содержит 2 метода (формирование рекомендации по id пользователя и проверка наличия пользователя в системе)
- app/models/lfm_model.pkl - pickle-файл с обученной моделью 
!!!(Необходимо положить файл в папку из ссылки: https://drive.google.com/drive/folders/1ZQ1UlJwg-SSqRpZDoRqTE3__D-PN7evF?usp=sharing)
- app/models/item_id.pkl - pickle-файл со sparese-матрицей 
- app/models/all_items.pkl - pickle-файл перечнем всех товаров